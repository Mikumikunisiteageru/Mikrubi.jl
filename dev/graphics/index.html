<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Graphics · Mikrubi.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Mikrubi.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../manual/">Manual</a></li><li class="is-active"><a class="tocitem" href>Graphics</a><ul class="internal"><li><a class="tocitem" href="#Plotting-with-Plots"><span>Plotting with Plots</span></a></li><li><a class="tocitem" href="#Plotting-with-PyPlot"><span>Plotting with PyPlot</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Graphics</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Graphics</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Mikumikunisiteageru/Mikrubi.jl/blob/main/docs/src/graphics.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Graphics"><a class="docs-heading-anchor" href="#Graphics">Graphics</a><a id="Graphics-1"></a><a class="docs-heading-anchor-permalink" href="#Graphics" title="Permalink"></a></h1><ul><li><a href="#Graphics">Graphics</a></li><li class="no-marker"><ul><li><a href="#Plotting-with-Plots">Plotting with Plots</a></li><li class="no-marker"><ul><li><a href="#Example-of-*Prinsepia-utilis*">Example of <em>Prinsepia utilis</em></a></li><li class="no-marker"><ul><li><a href="#Illustrating-the-shape-file">Illustrating the shape file</a></li><li><a href="#Illustrating-the-raster-layers">Illustrating the raster layers</a></li><li><a href="#Illustrating-the-rasterization-result">Illustrating the rasterization result</a></li><li><a href="#Illustrating-the-Mikrubi-field">Illustrating the Mikrubi field</a></li></ul></li></ul></li><li><a href="#Plotting-with-PyPlot">Plotting with PyPlot</a></li><li class="no-marker"><ul><li><a href="#Example-of-*Allium-wallichii*">Example of <em>Allium wallichii</em></a></li><li class="no-marker"><ul><li><a href="#Illustrating-the-shape-file-and-the-raw-layers">Illustrating the shape file and the raw layers</a></li><li><a href="#Illustrating-the-rasterization-result-2">Illustrating the rasterization result</a></li><li><a href="#Illustrating-the-extracted-layers-and-the-Mikrubi-field">Illustrating the extracted layers and the Mikrubi field</a></li><li><a href="#Illustrating-the-predictions">Illustrating the predictions</a></li></ul></li></ul></li></ul></li></ul><p>Objects in Mikrubi of various types (shape files, rasters, raster stacks, <code>Mikrubi.CtPixels</code> instances, Mikrubi fields) can be plotted by Plots or by PyPlot. </p><h2 id="Plotting-with-Plots"><a class="docs-heading-anchor" href="#Plotting-with-Plots">Plotting with Plots</a><a id="Plotting-with-Plots-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting-with-Plots" title="Permalink"></a></h2><p>After loading the Plots package, the objects can be plotted by <code>plot</code> or <code>plot!</code>. </p><h3 id="Example-of-*Prinsepia-utilis*"><a class="docs-heading-anchor" href="#Example-of-*Prinsepia-utilis*">Example of <em>Prinsepia utilis</em></a><a id="Example-of-*Prinsepia-utilis*-1"></a><a class="docs-heading-anchor-permalink" href="#Example-of-*Prinsepia-utilis*" title="Permalink"></a></h3><p>Here we use the distribution of <em>Prinsepia utilis</em> (Rosaceae) in Nepal as an example. First we get all the objects prepared.</p><pre><code class="language-julia hljs">using Mikrubi
using Plots
import GADM
import RasterDataSources; const RDS = RasterDataSources

shppath = GADM.download(&quot;NPL&quot;)

get!(ENV, &quot;RASTERDATASOURCES_PATH&quot;, tempdir())
RDS.getraster(RDS.WorldClim{RDS.BioClim}, res=&quot;10m&quot;)
climpath = RDS.rasterpath(RDS.WorldClim{RDS.BioClim})</code></pre><h4 id="Illustrating-the-shape-file"><a class="docs-heading-anchor" href="#Illustrating-the-shape-file">Illustrating the shape file</a><a id="Illustrating-the-shape-file-1"></a><a class="docs-heading-anchor-permalink" href="#Illustrating-the-shape-file" title="Permalink"></a></h4><p>The variable <code>shptable</code>, what is read through <a href="../manual/#Mikrubi.readshape"><code>readshape</code></a>, called a shape file here, can be <code>plot</code>ted.</p><pre><code class="nohighlight hljs">shptable = readshape(shppath, 1);

plot(shptable)
savefig(&quot;plots_shptable.png&quot;)</code></pre><p><img src="../illust/plots_shptable.png" alt="plots_shptable.png"/></p><h4 id="Illustrating-the-raster-layers"><a class="docs-heading-anchor" href="#Illustrating-the-raster-layers">Illustrating the raster layers</a><a id="Illustrating-the-raster-layers-1"></a><a class="docs-heading-anchor-permalink" href="#Illustrating-the-raster-layers" title="Permalink"></a></h4><p>We read the WorldClim raster <code>layers</code>, and extract the first raster <code>layer</code> from the stack, and then <code>plot</code> it.</p><pre><code class="language-julia hljs">layers = readlayers(climpath)
layer = first(layers)

plot(layer)
savefig(&quot;plots_layer.png&quot;)</code></pre><p><img src="../illust/plots_layer.png" alt="plots_layer.png"/></p><h4 id="Illustrating-the-rasterization-result"><a class="docs-heading-anchor" href="#Illustrating-the-rasterization-result">Illustrating the rasterization result</a><a id="Illustrating-the-rasterization-result-1"></a><a class="docs-heading-anchor-permalink" href="#Illustrating-the-rasterization-result" title="Permalink"></a></h4><p>Here <code>ctpixels</code> is the object storing the rasterization result, although in many cases the result is hidden in <a href="../manual/#Mikrubi.makefield"><code>makefield</code></a>. </p><pre><code class="language-julia hljs">ctpixels = rasterize(shptable, layer);

plot(ctpixels)
savefig(&quot;plots_ctpixels.png&quot;)</code></pre><p><img src="../illust/plots_ctpixels.png" alt="plots_ctpixels.png"/></p><h4 id="Illustrating-the-Mikrubi-field"><a class="docs-heading-anchor" href="#Illustrating-the-Mikrubi-field">Illustrating the Mikrubi field</a><a id="Illustrating-the-Mikrubi-field-1"></a><a class="docs-heading-anchor-permalink" href="#Illustrating-the-Mikrubi-field" title="Permalink"></a></h4><p>A Mikrubi field cannot be <code>plot</code>ted solely, because it does not contain enough information for illustrating. It must follow the corresponding raster grid in the argument list.</p><pre><code class="language-julia hljs">field, ylayers = makefield(layers, shptable);

plot(layer, field)
savefig(&quot;plots_field.png&quot;)</code></pre><p><img src="../illust/plots_field.png" alt="plots_field.png"/></p><h2 id="Plotting-with-PyPlot"><a class="docs-heading-anchor" href="#Plotting-with-PyPlot">Plotting with PyPlot</a><a id="Plotting-with-PyPlot-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting-with-PyPlot" title="Permalink"></a></h2><p>Since the PyPlot plotting engine is substantially the wrapped Python package <code>matplotlib</code>, users who wish to use PyPlot have to manually install the package, and then tell Mikrubi to use it by the following lines.</p><pre><code class="language-julia hljs">using PyPlot
setplot(PyPlot)</code></pre><p>Four functions are provided to illustrate the objects of different types.</p><article class="docstring"><header><a class="docstring-binding" id="Mikrubi.showshptable" href="#Mikrubi.showshptable"><code>Mikrubi.showshptable</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">showshptable(shptable; kwargs...)</code></pre><p>Show lines from polygons in <code>shptable</code>. Identical segments are reduced as one.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Mikumikunisiteageru/Mikrubi.jl/blob/9a9e47b8a5eb94151cd1cd1af91f859b997c6946/src/pyplot.jl#L236-L240">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Mikrubi.showlayer" href="#Mikrubi.showlayer"><code>Mikrubi.showlayer</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">showlayer(layer; f=identity, kwargs...)</code></pre><p>Show a layer. Keyword argument <code>f = identity</code> is a function acted separately on every element. A possible alternative is <code>f = x -&gt; x ^ 0.4</code>. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Mikumikunisiteageru/Mikrubi.jl/blob/9a9e47b8a5eb94151cd1cd1af91f859b997c6946/src/pyplot.jl#L90-L95">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Mikrubi.showfield" href="#Mikrubi.showfield"><code>Mikrubi.showfield</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">showlayer(layer; f=identity, kwargs...)
showfield(field, layer; f=tiedrank, kwargs...)</code></pre><p>Show geographic information and environmental information of a Mikrubi model. The three principal components are reflexed in red, green, and blue. Keyword argument <code>f = tiedrank</code> is a function acted on columns of <code>field.vars</code> as a  whole. A possible alternative is <code>f = identity</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Mikumikunisiteageru/Mikrubi.jl/blob/9a9e47b8a5eb94151cd1cd1af91f859b997c6946/src/pyplot.jl#L114-L122">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Mikrubi.showctpixels" href="#Mikrubi.showctpixels"><code>Mikrubi.showctpixels</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">showctpixels(ctpixels; salt=20, kwargs...)
showctpixels(ctpixels, layer; salt=20, kwargs...)</code></pre><p>Show a <code>Mikrubi.CtPixels</code>. Every county is assigned a hash color (influenced by a fixed <code>salt</code> value also), and every pixel has the composite color from all counties assigned to it. Empty cells are depicted white.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Mikumikunisiteageru/Mikrubi.jl/blob/9a9e47b8a5eb94151cd1cd1af91f859b997c6946/src/pyplot.jl#L162-L169">source</a></section></article><h3 id="Example-of-*Allium-wallichii*"><a class="docs-heading-anchor" href="#Example-of-*Allium-wallichii*">Example of <em>Allium wallichii</em></a><a id="Example-of-*Allium-wallichii*-1"></a><a class="docs-heading-anchor-permalink" href="#Example-of-*Allium-wallichii*" title="Permalink"></a></h3><p>In the beginning, here we get the packages, path strings, and decoration functions ready:</p><pre><code class="language-julia hljs">using Mikrubi
using PyPlot
setplot(PyPlot)

shppath = &quot;path/to/china/counties.shp&quot;;
climpath = &quot;path/to/worldclim/layers&quot;;
ctlistpath = &quot;path/to/occupied/county/list.txt&quot;;

largeaxis() = gca().set_position([0.06, 0.07, 0.9, 0.9])
worldwide() = (xlim(-180, 180); ylim(-90, 90))</code></pre><h4 id="Illustrating-the-shape-file-and-the-raw-layers"><a class="docs-heading-anchor" href="#Illustrating-the-shape-file-and-the-raw-layers">Illustrating the shape file and the raw layers</a><a id="Illustrating-the-shape-file-and-the-raw-layers-1"></a><a class="docs-heading-anchor-permalink" href="#Illustrating-the-shape-file-and-the-raw-layers" title="Permalink"></a></h4><p>Now the workflow is disassembled into steps, and we check the outputs by illustrating them.</p><p>First of all, a shape file is read into Julia. We can see clearly that the boundaries of counties of China plotted in black line.</p><pre><code class="language-julia hljs">shptable = readshape(shppath)

figure(figsize=(6.4, 6.4))
showshptable(shptable)
largeaxis()
savefig(&quot;pyplot_shptable.png&quot;)
close()</code></pre><p><img src="../illust/pyplot_shptable.png" alt="pyplot_shptable.png"/></p><p>Then, a series of WorldClim climatic factor layers are read in, and the first layer among them is illustrated.</p><pre><code class="language-julia hljs">layers = readlayers(climpath)

figure(figsize=(6.4, 3.2))
set_cmap(&quot;viridis&quot;)
showlayer(first(layers))
largeaxis()
worldwide()
savefig(&quot;pyplot_rawlayer1.png&quot;)
close()</code></pre><p><img src="../illust/pyplot_rawlayer1.png" alt="pyplot_rawlayer1.png"/></p><h4 id="Illustrating-the-rasterization-result-2"><a class="docs-heading-anchor" href="#Illustrating-the-rasterization-result-2">Illustrating the rasterization result</a><a class="docs-heading-anchor-permalink" href="#Illustrating-the-rasterization-result-2" title="Permalink"></a></h4><p>Later, counties are rasterized using the grid defined by the layers. Every exclusive pixel is assigned the characteristic color of the county it belongs to, while pixels shared by multiple counties are dyed composite (thus always darker) colors.</p><pre><code class="language-julia hljs">ctpixels = rasterize(shptable, first(layers))

figure(figsize=(6.4, 6.4))
showctpixels(ctpixels, first(layers))
showshptable(shptable, lw=0.5)
gca().set_aspect(&quot;auto&quot;)
largeaxis()
savefig(&quot;pyplot_ctpixels.png&quot;)</code></pre><p><img src="../illust/pyplot_ctpixels.png" alt="pyplot_ctpixels.png"/></p><p>Zoom in, and details of the rasterization result are clearer.</p><pre><code class="language-julia hljs">xlim(88, 98)
ylim(30, 40)
savefig(&quot;pyplot_ctpixels2.png&quot;)
close()</code></pre><p><img src="../illust/pyplot_ctpixels2.png" alt="pyplot_ctpixels2.png"/></p><h4 id="Illustrating-the-extracted-layers-and-the-Mikrubi-field"><a class="docs-heading-anchor" href="#Illustrating-the-extracted-layers-and-the-Mikrubi-field">Illustrating the extracted layers and the Mikrubi field</a><a id="Illustrating-the-extracted-layers-and-the-Mikrubi-field-1"></a><a class="docs-heading-anchor-permalink" href="#Illustrating-the-extracted-layers-and-the-Mikrubi-field" title="Permalink"></a></h4><p>Then, a Mikrubi field is constructed from the results above. Notable, <code>layers</code> lie in the input argument list at both the first and the third places. Layers at the first place are masked by the rasterization result and transformed into fewer (by default, three) layers by principal component analysis, and the results are finally assigned to <code>elayers</code> here. Meanwhile, layers at the third place undergo the same processes but no masking is applied, whose results are assigned to <code>eplayers</code>. </p><p>Now check the images of <code>first(elayers)</code> and <code>first(eplayers)</code> under the same <code>clim</code>, and we can see that they are actually identical on their overlapping part — because they are derived from the same input layers and have experienced the same operations.</p><pre><code class="language-julia hljs">field, elayers, eplayers = makefield(layers, ctpixels, layers)

figure(figsize=(6.4, 5.2))
showlayer(first(elayers))
gca().set_aspect(&quot;auto&quot;)
largeaxis()
clim(-6, 2)
savefig(&quot;pyplot_pcalayer1.png&quot;)
close()</code></pre><p><img src="../illust/pyplot_pcalayer1.png" alt="pyplot_pcalayer1.png"/></p><pre><code class="language-julia hljs">figure(figsize=(6.4, 3.2))
set_cmap(&quot;viridis&quot;)
showlayer(first(eplayers))
largeaxis()
worldwide()
clim(-6, 2)
savefig(&quot;pyplot_gpcalayer1.png&quot;)
close()</code></pre><p><img src="../illust/pyplot_gpcalayer1.png" alt="pyplot_gpcalayer1.png"/></p><p>At the same time, we may check the Mikrubi field just obtained visually in RGB space (skewed by <code>f = tiedrank</code> in <code>showfield</code> for better image representation). Parts of China are dyed different colors, and the pattern does coincide with our knowledge.</p><pre><code class="language-julia hljs">figure(figsize=(6.4, 5.2))
showfield(field, first(layers))
gca().set_aspect(&quot;auto&quot;)
largeaxis()
savefig(&quot;pyplot_field.png&quot;)
close()</code></pre><p><img src="../illust/pyplot_field.png" alt="pyplot_field.png"/></p><h4 id="Illustrating-the-predictions"><a class="docs-heading-anchor" href="#Illustrating-the-predictions">Illustrating the predictions</a><a id="Illustrating-the-predictions-1"></a><a class="docs-heading-anchor-permalink" href="#Illustrating-the-predictions" title="Permalink"></a></h4><p>Finally it is the fitting and the predictions. Since the model here is in high dimensionality beyond imagination, we turn to check the images of the predictions. Analogously, under the same <code>clim</code> values, the predicted regional distribution (<code>geodist</code>) and the predicted global distribution (<code>ggeodist</code>) are identical over their overlapping area. Using graphics, we can confirm that everything is in accordance with expectation.</p><pre><code class="language-julia hljs">ctlist = readlist(ctlistpath)
model = fit(field, ctlist)
geodist = predict(elayers, model)

figure(figsize=(6.4, 5.2))
set_cmap(&quot;CMRmap&quot;)
showlayer(geodist, f = x -&gt; x ^ 0.35)
gca().set_aspect(&quot;auto&quot;)
largeaxis()
clim(0, 0.45)
savefig(&quot;pyplot_geodist.png&quot;)
close()</code></pre><p><img src="../illust/pyplot_geodist.png" alt="pyplot_geodist.png"/></p><pre><code class="language-julia hljs">ggeodist = predict(eplayers, model)

figure(figsize=(6.4, 3.2))
set_cmap(&quot;CMRmap&quot;)
showlayer(ggeodist, f = x -&gt; x ^ 0.35)
largeaxis()
worldwide()
clim(0, 0.45)
savefig(&quot;pyplot_ggeodist.png&quot;)
close()</code></pre><p><img src="../illust/pyplot_ggeodist.png" alt="pyplot_ggeodist.png"/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../manual/">« Manual</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Thursday 11 May 2023 05:07">Thursday 11 May 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
