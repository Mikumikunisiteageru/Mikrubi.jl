<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Graphics · A Manual for Mikrubi</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><script src="../../copy.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">A Manual for Mikrubi</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../manual/">Manual</a></li><li class="is-active"><a class="tocitem" href>Graphics</a><ul class="internal"><li><a class="tocitem" href="#Module-introduction"><span>Module introduction</span></a></li><li><a class="tocitem" href="#The-example-of-*Allium-wallichii*"><span>The example of <em>Allium wallichii</em></span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Graphics</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Graphics</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Mikumikunisiteageru/Mikrubi.jl/blob/master/docs/src/graphics.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Mikrubi-Graphics"><a class="docs-heading-anchor" href="#Mikrubi-Graphics">Mikrubi Graphics</a><a id="Mikrubi-Graphics-1"></a><a class="docs-heading-anchor-permalink" href="#Mikrubi-Graphics" title="Permalink"></a></h1><ul><li><a href="#Mikrubi-Graphics">Mikrubi Graphics</a></li><li class="no-marker"><ul><li><a href="#Module-introduction">Module introduction</a></li><li><a href="#The-example-of-*Allium-wallichii*">The example of <em>Allium wallichii</em></a></li><li class="no-marker"><ul><li><a href="#Illustrating-the-shapefile-and-the-raw-layers">Illustrating the shapefile and the raw layers</a></li><li><a href="#Illustrating-the-rasterization">Illustrating the rasterization</a></li><li><a href="#Illustrating-the-extracted-layers-and-the-Mikrubi-field">Illustrating the extracted layers and the Mikrubi field</a></li><li><a href="#Illustrating-the-predictions">Illustrating the predictions</a></li></ul></li></ul></li></ul><h2 id="Module-introduction"><a class="docs-heading-anchor" href="#Module-introduction">Module introduction</a><a id="Module-introduction-1"></a><a class="docs-heading-anchor-permalink" href="#Module-introduction" title="Permalink"></a></h2><p><code>MikrubiGraphics</code> is an accessory module of <code>Mikrubi</code>. It illustrates many types of objects involved in <code>Mikrubi</code> including shapefile, raster layer, <code>Mikrubi.CtPixels</code>, and <code>MikrubiField</code> as images, which may be useful while debugging. </p><p>Since the plotting engine is substantially the Python package <code>matplotlib</code> (wrapped into Julia by <code>PyPlot.jl</code>), <code>MikrubiGraphics</code> is not imported into the main package. When necessary, users may include this accessory module either by <code>include(&quot;path/to/Mikrubi/src/MikrubiGraphics.jl&quot;)</code>, or by command <code>using MikrubiGraphics</code> as normal packages after <code>push!(LOAD_PATH, &quot;path/to/Mikrubi/src/&quot;)</code>, if Python as well as the Python package <code>matplotlib</code> has been installed.</p><article class="docstring"><header><a class="docstring-binding" id="MikrubiGraphics.showlayer" href="#MikrubiGraphics.showlayer"><code>MikrubiGraphics.showlayer</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">showlayer(layer; f=identity, kwargs...)</code></pre><p>Shows a layer. Keyword argument <code>f = identity</code> is a function acted separately on every element. A possible alternative is <code>f = x -&gt; x ^ 0.4</code>. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Mikumikunisiteageru/Mikrubi.jl/blob/9401b66e4f18b29c451315344a3ab405711b3671/src/MikrubiGraphics.jl#L10-L15">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MikrubiGraphics.showfield" href="#MikrubiGraphics.showfield"><code>MikrubiGraphics.showfield</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">showlayer(layer; f=identity, kwargs...)
showfield(field, layer; f=tiedrank, kwargs...)</code></pre><p>Shows geographic information and environmental information of a Mikrubi model. The three principal components are reflexed in red, green, and blue. Keyword argument <code>f = tiedrank</code> is a function acted on columns of <code>field.vars</code> as a  whole. A possible alternative is <code>f = identity</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Mikumikunisiteageru/Mikrubi.jl/blob/9401b66e4f18b29c451315344a3ab405711b3671/src/MikrubiGraphics.jl#L30-L38">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MikrubiGraphics.showctpixels" href="#MikrubiGraphics.showctpixels"><code>MikrubiGraphics.showctpixels</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">showctpixels(ctpixels, layer; salt=20, kwargs...)</code></pre><p>Shows a <code>Mikrubi.CtPixels</code>. Every county is assigned a hash color (influenced by a fixed <code>salt</code> value also), and every pixel has the composite color from all counties assigned to it. Empty cells are depicted white.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Mikumikunisiteageru/Mikrubi.jl/blob/9401b66e4f18b29c451315344a3ab405711b3671/src/MikrubiGraphics.jl#L83-L89">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MikrubiGraphics.showshptable" href="#MikrubiGraphics.showshptable"><code>MikrubiGraphics.showshptable</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">showshptable(shptable; kwargs...)</code></pre><p>Shows lines from polygons in <code>shptable</code>. Identical segments are reduced as one.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Mikumikunisiteageru/Mikrubi.jl/blob/9401b66e4f18b29c451315344a3ab405711b3671/src/MikrubiGraphics.jl#L149-L153">source</a></section></article><h2 id="The-example-of-*Allium-wallichii*"><a class="docs-heading-anchor" href="#The-example-of-*Allium-wallichii*">The example of <em>Allium wallichii</em></a><a id="The-example-of-*Allium-wallichii*-1"></a><a class="docs-heading-anchor-permalink" href="#The-example-of-*Allium-wallichii*" title="Permalink"></a></h2><p>In the beginning, here we get the packages, path strings, and decoration functions ready:</p><pre><code class="language-julia hljs">using Mikrubi
using MikrubiGraphics
using PyPlot

shpfile = &quot;path/to/china/counties.shp&quot;;
layerdir = &quot;path/to/worldclim/layers&quot;;
countylist = &quot;path/to/occupied/county/list.txt&quot;;

largeaxis() = gca().set_position([0.06, 0.07, 0.9, 0.9])
worldwide() = (xlim(-180, 180); ylim(-90, 90))</code></pre><h3 id="Illustrating-the-shapefile-and-the-raw-layers"><a class="docs-heading-anchor" href="#Illustrating-the-shapefile-and-the-raw-layers">Illustrating the shapefile and the raw layers</a><a id="Illustrating-the-shapefile-and-the-raw-layers-1"></a><a class="docs-heading-anchor-permalink" href="#Illustrating-the-shapefile-and-the-raw-layers" title="Permalink"></a></h3><p>Now the workflow is disassembled into steps, and we use functions implemented in <code>MikrubiGraphics</code> to check the outputs.</p><p>First of all, a shapefile is read into Julia. We can see clearly that the boundaries of counties of China plotted in black line.</p><pre><code class="language-julia hljs">shptable = readshape(shpfile)

figure(figsize=(6.4, 6.4))
showshptable(shptable)
largeaxis()
savefig(&quot;shpfile.png&quot;)
close()</code></pre><p><img src="../illust/shpfile.png" alt="Shapefile"/></p><p>Then, a series of WorldClim climatic factor layers are read in, and the first layer among them is illustrated.</p><pre><code class="language-julia hljs">layers = readlayers(layerdir)

figure(figsize=(6.4, 3.2))
set_cmap(&quot;viridis&quot;)
showlayer(layers[1])
largeaxis()
worldwide()
savefig(&quot;rawlayer1.png&quot;)
close()</code></pre><p><img src="../illust/rawlayer1.png" alt="First WorldClim layer"/></p><h3 id="Illustrating-the-rasterization"><a class="docs-heading-anchor" href="#Illustrating-the-rasterization">Illustrating the rasterization</a><a id="Illustrating-the-rasterization-1"></a><a class="docs-heading-anchor-permalink" href="#Illustrating-the-rasterization" title="Permalink"></a></h3><p>Later, counties are rasterized using the grid defined by the layers. Every exclusive pixel is assigned the characteristic color of the county it belongs to, while pixels shared by multiple counties are dyed composite (thus always darker) colors.</p><pre><code class="language-julia hljs">ctpixels = rasterize(shptable, layers[1])

figure(figsize=(6.4, 6.4))
showctpixels(ctpixels, layers[1])
showshptable(shptable, lw=0.5)
gca().set_aspect(&quot;auto&quot;)
largeaxis()
savefig(&quot;ctpixels.png&quot;)</code></pre><p><img src="../illust/ctpixels.png" alt="Rasterization zoom out"/></p><p>Zoom in, and details of the rasterization result are clearer.</p><pre><code class="language-julia hljs">xlim(88, 98)
ylim(30, 40)
savefig(&quot;ctpixels2.png&quot;)
close()</code></pre><p><img src="../illust/ctpixels2.png" alt="Rasterization zoom in"/></p><h3 id="Illustrating-the-extracted-layers-and-the-Mikrubi-field"><a class="docs-heading-anchor" href="#Illustrating-the-extracted-layers-and-the-Mikrubi-field">Illustrating the extracted layers and the Mikrubi field</a><a id="Illustrating-the-extracted-layers-and-the-Mikrubi-field-1"></a><a class="docs-heading-anchor-permalink" href="#Illustrating-the-extracted-layers-and-the-Mikrubi-field" title="Permalink"></a></h3><p>Then, a Mikrubi field is constructed from the results above. Notable, <code>layers</code> lie in the input argument list at both the first and the third places. Layers at the first place are masked by the rasterization result and transformed into fewer (by default, three) layers by principal component analysis, and the results are finally assigned to <code>ylayers</code> here. Meanwhile, layers at the third place undergo the same processes but no masking is applied, whose results are assigned to <code>gylayers</code>. </p><p>Now check the images of <code>ylayers[1]</code> and <code>gylayers[1]</code> under the same <code>clim</code>, and we can see that they are actually identical on their overlapping part — because they are derived from the same input layers and have experienced the same operations.</p><pre><code class="language-julia hljs">field, ylayers, gylayers = makefield(layers, ctpixels, layers)

figure(figsize=(6.4, 5.2))
showlayer(ylayers[1])
gca().set_aspect(&quot;auto&quot;)
largeaxis()
clim(-6, 2)
savefig(&quot;pcalayer1.png&quot;)
close()</code></pre><p><img src="../illust/pcalayer1.png" alt="First extracted masked layer"/></p><pre><code class="language-julia hljs">figure(figsize=(6.4, 3.2))
set_cmap(&quot;viridis&quot;)
showlayer(gylayers[1])
largeaxis()
worldwide()
clim(-6, 2)
savefig(&quot;gpcalayer1.png&quot;)
close()</code></pre><p><img src="../illust/gpcalayer1.png" alt="First extracted unmasked layer"/></p><p>At the same time, we may check the Mikrubi field just obtained visually in RGB space (skewed by <code>f = tiedrank</code> in <code>showfield</code> for better image representation). Parts of China are dyed different colors, and the pattern does coincide with our knowledge.</p><pre><code class="language-julia hljs">figure(figsize=(6.4, 5.2))
showfield(field, layers[1])
gca().set_aspect(&quot;auto&quot;)
largeaxis()
savefig(&quot;field.png&quot;)
close()</code></pre><p><img src="../illust/field.png" alt="The Mikrubi field"/></p><h3 id="Illustrating-the-predictions"><a class="docs-heading-anchor" href="#Illustrating-the-predictions">Illustrating the predictions</a><a id="Illustrating-the-predictions-1"></a><a class="docs-heading-anchor-permalink" href="#Illustrating-the-predictions" title="Permalink"></a></h3><p>Finally it is the fitting and the predictions. Since the model here is in high dimensionality beyond imagination, we turn to check the images of the predictions. Analogously, under the same <code>clim</code> values, the predicted regional distribution (<code>geodist</code>) and the predicted global distribution (<code>ggeodist</code>) are identical over their overlapping area. Using graphics, we can confirm that everything is in accordance with expectation.</p><pre><code class="language-julia hljs">ctlist = readlist(countylist)
model = fit(field, ctlist)
geodist = predict(ylayers, model)

figure(figsize=(6.4, 5.2))
set_cmap(&quot;CMRmap&quot;)
showlayer(geodist, f = x -&gt; x ^ 0.35)
gca().set_aspect(&quot;auto&quot;)
largeaxis()
clim(0, 0.45)
savefig(&quot;geodist.png&quot;)
close()</code></pre><p><img src="../illust/geodist.png" alt="Distribution predicted using masked layers"/></p><pre><code class="language-julia hljs">ggeodist = predict(gylayers, model)

figure(figsize=(6.4, 3.2))
set_cmap(&quot;CMRmap&quot;)
showlayer(ggeodist, f = x -&gt; x ^ 0.35)
largeaxis()
worldwide()
clim(0, 0.45)
savefig(&quot;ggeodist.png&quot;)
close()</code></pre><p><img src="../illust/ggeodist.png" alt="Distribution predicted using unmasked layers"/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../manual/">« Manual</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.12 on <span class="colophon-date" title="Thursday 16 June 2022 18:00">Thursday 16 June 2022</span>. Using Julia version 1.4.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
